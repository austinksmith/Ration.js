module.exports=function(t){function e(s){if(i[s])return i[s].exports;var r=i[s]={exports:{},id:s,loaded:!1};return t[s].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){t.exports=i(1)},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),r=function(){function t(){i(this,t),this.setRations=this.init,this.startRations=this.enforceRations.bind(this),this.checkRations=this.compareVisits,this.saveUsersRations=this.saveRequest}return s(t,[{key:"init",value:function(t){var e=this;this.removeRecordsAfter=3e5;for(var i in t)this[i]=t[i];this.timeFrameInMS=1e3*this.timeFrameInSeconds,this.maxRequestsWithinTimeFrame=this.maxRequestsPerTimeFrame*this.timeFrameInSeconds,this.delayInMS=1e3/this.maxRequestsPerTimeFrame,this.visits=[],setInterval(function(){e.restoreRations()},this.removeRecordsAfter)}},{key:"restoreRations",value:function(){for(var t=this.visits.length-1;t>=0;t--){var e=Date.now()-this.visits[t].lastRequestAt;e>=this.removeRecordsAfter&&this.visits.splice(t,1)}}},{key:"compareVisits",value:function(t,e){for(var i=void 0,s=void 0,r=void 0,n=this.visits.length-1;n>=0;n--)i=this.visits[n].requestBy===t.requestBy,i&&s<this.removeRecordsAfter?(this.visits[n].requestCount+=1,r=this.visits[n].delayMultiplier,this.visits[n].requestCount>=maxRequestsWithinTimeFrame&&(r+=1),this.visits[n].lastRequestAt=t.newRequestAt,this.visits[n].delayMultiplier=r):s>this.timeFrameInMS&&(this.visits[n].requestCount=1,this.visits[n].delayMultiplier=1);setTimeout(function(){e()},this.delayInMS*r)}},{key:"enforceRations",value:function(t,e,i){var s={requestBy:t.header("x-forwarded-for")||t.connection.remoteAddress,newRequestAt:Date.now(),lastRequestAt:Date.now(),delayMultiplier:1,requestCount:1};0===this.visits.length?(this.visits.push(s),i()):this.compareVisits(s,i)}}]),t}(),n=new r;"undefined"!=typeof t&&"undefined"!=typeof t.exports&&(t.exports=n)}]);
//# sourceMappingURL=ration.node.min.js.map