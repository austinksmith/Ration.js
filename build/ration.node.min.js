module.exports=function(t){function e(i){if(s[i])return s[i].exports;var n=s[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var s={};return e.m=t,e.c=s,e.p="",e(0)}([function(t,e,s){t.exports=s(1)},function(t,e){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),n=function(){function t(){s(this,t),this.setRations=this.init,this.startRations=this.enforceRations.bind(this),this.checkRations=this.compareVisits,this.saveUsersRations=this.saveRequest,this.maxRequestsPerTimeFrame=600,this.timeFrameInSeconds=30,this.removeRecordsAfter=3e5,this.dropConnections=!1}return i(t,[{key:"init",value:function(t){this.removeRecordsAfter=3e5;for(var e in t)this[e]=t[e];this.timeFrameInMS=1e3*this.timeFrameInSeconds,this.delayInMS=1e3/this.maxRequestsPerTimeFrame,this.visits=[],this.setRestoreRationsInterval(this.removeRecordsAfter)}},{key:"setRestoreRationsInterval",value:function(t){var e=this;setInterval(function(){e.restoreRations()},t)}},{key:"restoreRations",value:function(){for(var t=this.visits.length-1;t>=0;t--){var e=Date.now()-this.visits[t].lastRequestAt;e>=this.removeRecordsAfter&&this.visits.splice(t,1)}}},{key:"compareVisits",value:function(t,e,s){for(var i=void 0,n=void 0,r=void 0,o=this.visits.length-1;o>=0;o--)i=this.visits[o].requestBy===t.requestBy,i&&(n=t.newRequestAt-this.visits[o].lastRequestAt,r=this.visits[o].delayMultiplier,n<this.timeFrameInMS?(this.visits[o].requestCount+=1,this.visits[o].requestCount>=this.maxRequestsWithinTimeFrame&&(r+=1),this.visits[o].lastRequestAt=t.newRequestAt,this.visits[o].delayMultiplier=r):(this.visits[o].requestCount=1,this.visits[o].delayMultiplier=1));this.processRequest(r,e,s)}},{key:"processRequest",value:function(t,e,s){this.dropConnections&&1!==t?e.end():setTimeout(function(){s()},this.delayInMS*t)}},{key:"enforceRations",value:function(t,e,s){var i={requestBy:t.header("x-forwarded-for")||t.connection.remoteAddress,newRequestAt:Date.now(),lastRequestAt:Date.now(),delayMultiplier:1,requestCount:1};0===this.visits.length?(this.visits.push(i),s()):this.compareVisits(i,e,s)}}]),t}(),r=new n;"undefined"!=typeof t&&"undefined"!=typeof t.exports&&(t.exports=r)}]);
//# sourceMappingURL=ration.node.min.js.map